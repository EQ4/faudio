(in-package :audio-engine)
(defctype message-address ptr)
(defctype message ptr)
(defctype message-receiver (:pointer :void))
(defctype message-sender (:pointer :void))
(defcfun (message-send "doremir_message_send") :void (a ptr) (b message-address) (c message))
(defcfun (message-add-receiver "doremir_message_add_receiver") :void (a ptr) (b message-receiver))
(defcfun (message-remove-receiver "doremir_message_remove_receiver") :void (a ptr) (b message-receiver))
(defcfun (message-dispatch "doremir_message_dispatch") :void (a ptr))
(define-foreign-type message-dispatcher-type () () (:actual-type :pointer))
(define-parse-method message-dispatcher () (make-instance 'message-dispatcher-type))
(defclass message-dispatcher () ((message-dispatcher-ptr :initarg :message-dispatcher-ptr)))
(defmethod translate-to-foreign (x (type message-dispatcher-type)) (slot-value x 'message-dispatcher-ptr))
(defmethod translate-from-foreign (x (type message-dispatcher-type)) (make-instance 'message-dispatcher :message-dispatcher-ptr x))
(defcfun (message-simple "doremir_message_simple") message-dispatcher)
(defcfun (message-destroy "doremir_message_destroy") :void (a message-dispatcher))
(defcfun (message-buffered "doremir_message_buffered") pair)
(defcfun (message-non-blocking "doremir_message_non_blocking") pair)