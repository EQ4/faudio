<!-- HTML header for doxygen 1.8.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3"/>
<title>faudio v2.7.4: Devices</title>
<!-- <link href="tabs.css" rel="stylesheet" type="text/css"/> -->
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="styles.css" rel="stylesheet" type="text/css" />
<!-- <link href="doxygen.css" rel="stylesheet" type="text/css" /> -->
<!--  -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">faudio v2.7.4
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Introduction</span></a></li>
      <li class="current"><a href="pages.html"><span>Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Devices </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#RealTime">Real time devices</a><ul><li class="level2"><a href="#SessionsAndStreams">Sessions and streams</a></li>
<li class="level2"><a href="#Notifications">Session notifications</a></li>
<li class="level2"><a href="#AudioStreams">Audio streams</a><ul><li class="level3"><a href="#AudioAR">Imperative style</a></li>
<li class="level3"><a href="#AudioCB">Callback style</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#id8127832">Non-realtime devices</a><ul><li class="level2"><a href="#id98281723">The run method</a></li>
<li class="level2"><a href="#id9192746">File devices</a></li>
<li class="level2"><a href="#id11127283">Buffer devices</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="Devices"></a></p>
<p>Devices are the entities that allow <em>faudio</em> to communicate with the outside world. Any client will need to connect at least two devices to each other to form a audio stream. While signals and processors denote functions, devices denote sources and sinks of audio data, such as files, memory buffers or audio hardware.</p>
<p>Devices are grouped into <em>real-time devices</em>, <em>non-real-time devices</em>. Audio and midi information are handled by different devices. Note that <em>faudio</em> does not provide non-real-time midi at the moment: if you need to parse and process a midi file you must use some other method.</p>
<h1><a class="anchor" id="RealTime"></a>
Real time devices</h1>
<h2><a class="anchor" id="SessionsAndStreams"></a>
Sessions and streams</h2>
<p><em>faudio</em> provides access to real-time devices through of <em>sessions</em>, and <em>streams</em>. While a <em>device</em> provides access to an external audio interface, a <em>session</em> provides access to the entire audio system, and a <em>stream</em> to a specific audio computation. These concepts are hierarchical, each stream is associated with a device and each device with a session.</p>
<p>Typically, each physical audio or midi interface is represented by a single device in <em>faudio</em>. The operating system may also provide abstract devices, representing network connections, software mixers and the like.</p>
<p><em>faudio</em> places certain restrictions on the order or acquisition of sessions, devices and streams. Any client that wants to obtain a device must first initiate a session. The initialization of a session may fail, for example if the underlying audio system is already being used by an exclusive process. If it succeeds, a handle to the underlying session is provided. This handle allow the user to inspect the set of devices available in the sesssion. The client may then open a stream.</p>
<p>TODO</p>
<div class="image">
<img src="device_states.png" alt="device_states.png"/>
<div class="caption">
State transactions of the audio system (simplified)</div></div>
<dl class="section note"><dt>Note</dt><dd>The semantics of <em>streams</em> have been changed from earlier versions of <em>faudio</em>, in which a <em>stream</em> could be repeatedly stopped and started.</dd></dl>
<h2><a class="anchor" id="Notifications"></a>
Session notifications</h2>
<p>Sessions represent a snapshot of the setup at the time it was initiated; the set of available devices in a specific session will never change. If a change in the underlying audio system is detected while a session is still active, a new session has to be started to observe the new setup.</p>
<p>You can register a callback to be invoked when the a possible change in hardware setup is detected, see fa__audio_set_status_callback. Note that this callback may be invoked in an interrupt handler thread and that the task of ending a session should generally be handled in the same thread that created the session. Use an atomic reference or a condition variable to communicate the notification to the appropriate thread.</p>
<h2><a class="anchor" id="AudioStreams"></a>
Audio streams</h2>
<h3><a class="anchor" id="AudioAR"></a>
Imperative style</h3>
<p>The acquire-release style use a paired method pattern. You call a creation method to get a value, and a destruction method to release. Note that devices, sessions and streams have single-ownership semantics.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fa_2fa_8h.html">fa/fa.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> <span class="keyword">const</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group___fa_audio.html#ga62ee22268c23f1b18447141feccc01e0" title="An audio session.">fa_audio_session_t</a>     session;</div>
<div class="line">    <a class="code" href="group___fa_audio.html#ga03de89ee66c6465f8cedd3a0286598f4" title="An audio device.">fa_audio_device_t</a>      input, output;</div>
<div class="line">    <a class="code" href="group___fa_audio.html#ga78fbee3026130ce00d8e00a4e73a84c3" title="An audio stream.">fa_audio_stream_t</a>      stream</div>
<div class="line">    <a class="code" href="group___fa_signal.html#gac5c72f160cd6e93a6783551627b166e5" title="The abstract type of signals.">fa_signal_t</a>            id;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Processor to use</span></div>
<div class="line">    <span class="keywordtype">id</span> = fa_signal_identity();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Begin session</span></div>
<div class="line">    session = <a class="code" href="group___fa_audio.html#ga0022e6e72ee2f2c4c04a6165847a50dd" title="Begin a new audio session.">fa_audio_begin_session</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___fa.html#gacc01bbdf50f2aa29f3975c25d9c8204c" title="Return whether the given value is an error or not.">fa_check</a>(stream)) {</div>
<div class="line">        <a class="code" href="group___fa_error.html#ga0053afc7a37791bee61e09b927a98de6" title="Write a log message.">fa_error_log</a>(stream);</div>
<div class="line">        <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// Session obtained, we can now access devices</span></div>
<div class="line">        input  = <a class="code" href="group___fa_audio.html#ga42d3ed3b24b951f57c8009ae6e50a0b6" title="Get the standard input device of the given session.">fa_audio_default_input</a>(session);</div>
<div class="line">        input  = <a class="code" href="group___fa_audio.html#ga69dbc7e4715ae5441d6fe7b888213927" title="Get the standard output device of the given session.">fa_audio_default_output</a>(session);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Start stream</span></div>
<div class="line">        stream = <a class="code" href="group___fa_audio.html#gac940850b30ca90bbefa38b290f2c0b1c" title="Open a stream on the given devices.">fa_audio_open_stream</a>(input, <span class="keywordtype">id</span>, output);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group___fa.html#gacc01bbdf50f2aa29f3975c25d9c8204c" title="Return whether the given value is an error or not.">fa_check</a>(stream)) {</div>
<div class="line">            <a class="code" href="group___fa_error.html#ga0053afc7a37791bee61e09b927a98de6" title="Write a log message.">fa_error_log</a>(stream);</div>
<div class="line">            <span class="keywordflow">goto</span> cleanup;</div>
<div class="line"></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// Stream active, let it run for 5 seconds</span></div>
<div class="line">            fa_thread_sleep(5000);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Cleanup</span></div>
<div class="line">cleanup:</div>
<div class="line">    <a class="code" href="group___fa.html#ga022f0971e46eebf097b5e64c089bd715" title="Destroy the given value.">fa_destroy</a>(stream);</div>
<div class="line">    <a class="code" href="group___fa.html#ga022f0971e46eebf097b5e64c089bd715" title="Destroy the given value.">fa_destroy</a>(session);</div>
<div class="line">    <a class="code" href="group___fa.html#ga022f0971e46eebf097b5e64c089bd715" title="Destroy the given value.">fa_destroy</a>(<span class="keywordtype">id</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="AudioCB"></a>
Callback style</h3>
<p>The callback style require that you provide a callback to be invoked when the session or stream is valid. Destruction is handled automatically after this method has returned. Errors are handled by a special callback, to which you can pass <a class="el" href="group___fa_error.html#ga0053afc7a37791bee61e09b927a98de6">fa_error_log</a>, or a user defined function.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fa_2fa_8h.html">fa/fa.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="util_8h.html">fa/util.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line">stream_t run_callback(stream_t stream)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Stream active, let it run for 5 seconds</span></div>
<div class="line">    fa_thread_sleep(<a class="code" href="util_8h.html#a1a3cd4cff330c981ed89bbd3a3426273">seconds</a>(10));</div>
<div class="line">    <span class="keywordflow">return</span> stream;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">session_t session_callback(<span class="keywordtype">void</span>* data, session_t session)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group___fa_audio.html#ga03de89ee66c6465f8cedd3a0286598f4" title="An audio device.">fa_audio_device_t</a>    input, output;</div>
<div class="line">    <a class="code" href="group___fa_signal.html#gac5c72f160cd6e93a6783551627b166e5" title="The abstract type of signals.">fa_signal_t</a>          id;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Session obtained, we can now access devices</span></div>
<div class="line">    input   = <a class="code" href="group___fa_audio.html#ga42d3ed3b24b951f57c8009ae6e50a0b6" title="Get the standard input device of the given session.">fa_audio_default_input</a>(session);</div>
<div class="line">    output  = <a class="code" href="group___fa_audio.html#ga42d3ed3b24b951f57c8009ae6e50a0b6" title="Get the standard input device of the given session.">fa_audio_default_input</a>(session);</div>
<div class="line">    <span class="keywordtype">id</span>      = (<a class="code" href="util_8h.html#a4179e0566b0727e21f1fd4b5e6533dee">signal_t</a>*) data;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Start stream</span></div>
<div class="line">    <a class="code" href="group___fa_audio.html#ga97e7226c9bd1b6fc122300cf156ab239" title="Run a stream on the given devices.">fa_audio_with_stream</a>(input, <span class="keywordtype">id</span>, output,</div>
<div class="line">                          run_callback, <a class="code" href="group___fa_error.html#ga0053afc7a37791bee61e09b927a98de6" title="Write a log message.">fa_error_log</a>, NULL);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="group___fa.html#ga022f0971e46eebf097b5e64c089bd715" title="Destroy the given value.">fa_destroy</a>(<span class="keywordtype">id</span>);</div>
<div class="line">    <span class="keywordflow">return</span> session;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> <span class="keyword">const</span> *argv[])</div>
<div class="line">{                  </div>
<div class="line">    <span class="comment">// Processor to use</span></div>
<div class="line">    <a class="code" href="group___fa_signal.html#gac5c72f160cd6e93a6783551627b166e5" title="The abstract type of signals.">fa_signal_t</a> signal = fa_signal_identity();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Begin session</span></div>
<div class="line">    <a class="code" href="group___fa_audio.html#ga10f42df431c12566e51f9c830c888822" title="Begin a new session, and retain it for the duration of a call to the given function.">fa_audio_with_session</a>(session_callback, <span class="keywordtype">id</span>,</div>
<div class="line">                           <a class="code" href="group___fa_error.html#ga0053afc7a37791bee61e09b927a98de6" title="Write a log message.">fa_error_log</a>, NULL);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="id8127832"></a>
Non-realtime devices</h1>
<h2><a class="anchor" id="id98281723"></a>
The run method</h2>
<p>TODO</p>
<h2><a class="anchor" id="id9192746"></a>
File devices</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fa_2fa_8h.html">fa/fa.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> fa_file_t      device_t;</div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="group___fa_signal.html#gac5c72f160cd6e93a6783551627b166e5" title="The abstract type of signals.">fa_signal_t</a>    <a class="code" href="util_8h.html#a4179e0566b0727e21f1fd4b5e6533dee">signal_t</a>;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> <span class="keyword">const</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    fa_device_t    input, output;</div>
<div class="line">    <a class="code" href="group___fa_signal.html#gac5c72f160cd6e93a6783551627b166e5" title="The abstract type of signals.">fa_signal_t</a>    id;</div>
<div class="line">    fa_result_t    result;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Processor to use</span></div>
<div class="line">    <span class="keywordtype">id</span> = fa_signal_identity();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Open streams</span></div>
<div class="line">    input   = fa__file_open(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;test/in.wav&quot;</span>));</div>
<div class="line">    output  = fa__file_open(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;test/out.wav&quot;</span>));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Handle possible errors</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___fa.html#gacc01bbdf50f2aa29f3975c25d9c8204c" title="Return whether the given value is an error or not.">fa_check</a>(input)) {</div>
<div class="line">        <a class="code" href="group___fa_error.html#ga0053afc7a37791bee61e09b927a98de6" title="Write a log message.">fa_error_log</a>(result);</div>
<div class="line">    }                                    </div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___fa.html#gacc01bbdf50f2aa29f3975c25d9c8204c" title="Return whether the given value is an error or not.">fa_check</a>(output)) {</div>
<div class="line">        <a class="code" href="group___fa_error.html#ga0053afc7a37791bee61e09b927a98de6" title="Write a log message.">fa_error_log</a>(result);</div>
<div class="line">    }                                    </div>
<div class="line"></div>
<div class="line">    result  = fa__file_run(in, <span class="keywordtype">id</span>, out);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Handle possible error</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___fa.html#gacc01bbdf50f2aa29f3975c25d9c8204c" title="Return whether the given value is an error or not.">fa_check</a>(result)) {</div>
<div class="line">        <a class="code" href="group___fa_error.html#ga0053afc7a37791bee61e09b927a98de6" title="Write a log message.">fa_error_log</a>(result);</div>
<div class="line">    }                                    </div>
<div class="line"></div>
<div class="line">    <a class="code" href="group___fa.html#ga022f0971e46eebf097b5e64c089bd715" title="Destroy the given value.">fa_destroy</a>(input);</div>
<div class="line">    <a class="code" href="group___fa.html#ga022f0971e46eebf097b5e64c089bd715" title="Destroy the given value.">fa_destroy</a>(output);;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="id11127283"></a>
Buffer devices</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="fa_2fa_8h.html">fa/fa.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">typedef</span> fa_file_t   device_t;</div>
<div class="line"><span class="keyword">typedef</span> <a class="code" href="group___fa_signal.html#gac5c72f160cd6e93a6783551627b166e5" title="The abstract type of signals.">fa_signal_t</a> <a class="code" href="util_8h.html#a4179e0566b0727e21f1fd4b5e6533dee">signal_t</a>;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> <span class="keyword">const</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    device_t    input, output;</div>
<div class="line">    signal_t    id;</div>
<div class="line">    result_t    result;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Processor to use</span></div>
<div class="line">    <span class="keywordtype">id</span> = fa_signal_identity();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Open streams</span></div>
<div class="line">    input   = fa_buffer_open(<a class="code" href="group___fa_buffer.html#ga43b53698a7fee13e6527fa7852c22e10" title="Create a new buffer and initialize it to zero-bytes.">fa_buffer_create</a>(1024));</div>
<div class="line">    output  = fa_buffer_open(<a class="code" href="group___fa_buffer.html#ga43b53698a7fee13e6527fa7852c22e10" title="Create a new buffer and initialize it to zero-bytes.">fa_buffer_create</a>(1024));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Handle possible errors</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___fa.html#gacc01bbdf50f2aa29f3975c25d9c8204c" title="Return whether the given value is an error or not.">fa_check</a>(input)) {</div>
<div class="line">        <a class="code" href="group___fa_error.html#ga0053afc7a37791bee61e09b927a98de6" title="Write a log message.">fa_error_log</a>(result);</div>
<div class="line">    }                                    </div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___fa.html#gacc01bbdf50f2aa29f3975c25d9c8204c" title="Return whether the given value is an error or not.">fa_check</a>(output)) {</div>
<div class="line">        <a class="code" href="group___fa_error.html#ga0053afc7a37791bee61e09b927a98de6" title="Write a log message.">fa_error_log</a>(result);</div>
<div class="line">    }                                    </div>
<div class="line"></div>
<div class="line">    result  = fa_buffer_run(in, <span class="keywordtype">id</span>, out);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Handle possible error</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group___fa.html#gacc01bbdf50f2aa29f3975c25d9c8204c" title="Return whether the given value is an error or not.">fa_check</a>(result)) {</div>
<div class="line">        <a class="code" href="group___fa_error.html#ga0053afc7a37791bee61e09b927a98de6" title="Write a log message.">fa_error_log</a>(result);</div>
<div class="line">    }                                    </div>
<div class="line"></div>
<div class="line">    <a class="code" href="group___fa.html#ga022f0971e46eebf097b5e64c089bd715" title="Destroy the given value.">fa_destroy</a>(input);</div>
<div class="line">    <a class="code" href="group___fa.html#ga022f0971e46eebf097b5e64c089bd715" title="Destroy the given value.">fa_destroy</a>(output);</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Dec 2 2013 17:27:33 for faudio v2.7.4 by &#160;<a href="http://www.doxygen.org/index.html">Doxygen<!-- <img class="footer" src="doxygen.png" alt="doxygen"/> --></a> 1.8.3
</small></address>
</body>
</html>
