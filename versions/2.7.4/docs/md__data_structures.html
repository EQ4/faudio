<!-- HTML header for doxygen 1.8.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3"/>
<title>faudio v2.7.4: Data structures</title>
<!-- <link href="tabs.css" rel="stylesheet" type="text/css"/> -->
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="styles.css" rel="stylesheet" type="text/css" />
<!-- <link href="doxygen.css" rel="stylesheet" type="text/css" /> -->
<!--  -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">faudio v2.7.4
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Introduction</span></a></li>
      <li class="current"><a href="pages.html"><span>Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Data structures </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Overview">Overview</a></li>
<li class="level1"><a href="#Conventions">Using data structures</a><ul><li class="level2"><a href="#CreateCopyDestroy">Creation and destruction</a></li>
<li class="level2"><a href="#Literals">Creating from strings</a></li>
<li class="level2"><a href="#ForEach">Accessing all elements</a></li>
<li class="level2"><a href="#MapFoldFilter">Mapping, folding and filtering</a></li>
<li class="level2"><a href="#ThreadSafety">Thread safety</a></li>
<li class="level2"><a href="#id19466">Type safety</a></li>
</ul>
</li>
<li class="level1"><a href="#id182783728273">Value references</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="DataStructures"></a></p>
<p><em>faudio</em> include a set of general purpose <a href="http://en.wikipedia.org/wiki/Persistent_data_structure">persistent&#160;data&#160;structures</a>, which are primarily used for message passing between the audio thread and other threads. The fact that the data structures are persistent eliminate many of the problems commonly associated with multi-threaded programming.</p>
<p>The data structures in <em>faudio</em> are somewhat different from the structures found in most languages, in that they have single-ownership semantics. This eliminates the need for a garbage collector while still allowing a high-level programming style. To understand single-ownership semantics, you should read the section about <a class="el" href="md__data_structures.html#CreateCopyDestroy">creation&#160;and&#160;destruction</a> below. All data structures are polymorphic over reference types, see the section on <a class="el" href="md__data_structures.html#id19466">type&#160;safety</a> for more details.</p>
<p>Note that there is no interface capturing the notion of a data structure: they are simply reference types obeying the conventions described below. However, all data structures support generic <a class="el" href="structfa__equal__t.html">equality</a> or <a class="el" href="structfa__order__t.html">ordering</a>, <a class="el" href="structfa__copy__t.html">copying</a> and <a class="el" href="structfa__destroy__t.html">destruction</a>.</p>
<h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p>The core data structures are:</p>
<table class="doxtable">
<tr>
<th>Type </th><th>Semantics</th></tr>
<tr>
<td><a class="el" href="group___fa_pair.html">Pair</a> </td><td>An ordered pair </td></tr>
<tr>
<td><a class="el" href="group___fa_list.html">List</a> </td><td>An ordered sequence </td></tr>
<tr>
<td>Set </td><td>An ordered set </td></tr>
<tr>
<td><a class="el" href="group___fa_map.html">Map</a> </td><td>A set of ordered pairs </td></tr>
<tr>
<td><a class="el" href="group___fa_string.html">String</a> </td><td>A sequence of Unicode characters </td></tr>
</table>
<p>There is also a set of <em>mutable</em> data structures not included in this table. These are used internally in <em>faudio</em> and need rarely be accessed by the user. For completeness, they are:</p>
<table class="doxtable">
<tr>
<th>Type </th><th>Semantics</th></tr>
<tr>
<td>Atomic </td><td>An atomic reference </td></tr>
<tr>
<td>Atomic queue </td><td>A first-in, first-out atomic queue </td></tr>
<tr>
<td>Atomic stack </td><td>A last-in, first-out atomic queue </td></tr>
<tr>
<td><a class="el" href="group___fa_buffer.html">Buffer</a> </td><td>A byte-level mutable buffer </td></tr>
</table>
<h1><a class="anchor" id="Conventions"></a>
Using data structures</h1>
<h2><a class="anchor" id="CreateCopyDestroy"></a>
Creation and destruction</h2>
<p>TODO</p>
<h2><a class="anchor" id="Literals"></a>
Creating from strings</h2>
<h3>Show</h3>
<p>When <a class="el" href="group___fa.html#ga9215cf018539286a2ccd5c5f69ddb7f6">printed</a>, the data structures are rendered in a language-neutral form.</p>
<ul>
<li><code>(1,2)</code></li>
<li><code>[1,2,3]</code></li>
<li><code>{1,2,3}</code></li>
<li><code>{foo:1,bar:2}</code></li>
<li><code>({1,2,3},{((1,2),"foo"),((1,3):"bar")})</code></li>
</ul>
<h3>Literals</h3>
<p>All data structures have <em>literals</em> defined in the <a class="el" href="literals_8h.html">utility&#160;headers</a>. A literal expression always evaluate to a newly created instance of the data structure. Beware not to pass a number to the literals, you must use <a class="el" href="md__data_structures.html#ValueReferences">value&#160;references</a>.</p>
<ul>
<li><code>pair(<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(1)</a>,<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(2)</a>)</code></li>
<li><code>list(<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(1)</a>,<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(2)</a>,<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(3)</a>)</code></li>
<li><code>set(<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(1)</a>,<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(2)</a>,<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(3)</a>)</code></li>
<li><code>map(string("foo"),<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(1)</a>,string("bar"),<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(2)</a>)</code></li>
<li><code>graph(<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(1)</a>,<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(2)</a>,edge(<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(1)</a>,<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(2)</a>,<a class="el" href="util_8h.html#a832509ea197065489f1d60b6d7958cbf">i32(3)</a>))</code></li>
</ul>
<h3>JSON</h3>
<p>TODO</p>
<h2><a class="anchor" id="ForEach"></a>
Accessing all elements</h2>
<p>TODO</p>
<h2><a class="anchor" id="MapFoldFilter"></a>
Mapping, folding and filtering</h2>
<p>TODO</p>
<h2><a class="anchor" id="ThreadSafety"></a>
Thread safety</h2>
<p>All operations on data structures are thread-safe except creation, copying and destruction, which are subject to the following restrictions:</p>
<ul>
<li>If a data structure <em>a</em> is created in thread <em>t</em> and used in thread <em>u</em>, an ordering must be established between the creation function returning in <em>t</em> and subsequent use of <em>a</em> in <em>u</em>.</li>
</ul>
<ul>
<li>If a data structure <em>a</em> is used in thread <em>t</em> and destroyed in thread <em>u</em>, an ordering must be established between the last use of <em>a</em> in <em>t</em> and the destructive function being applied in <em>u</em>.</li>
</ul>
<p>To establish an ordering, you should either synchronize the threads <em>t</em> and <em>u</em>, or transfer the data structure in an atomic variable or queue. Note that copying is considered both <em>usage</em> of the copied value and a <em>creation</em> of the copy. Also some functions (such as <a class="el" href="group___fa_list.html#ga2bf9a699ab55ff76f4c84fb21cdf0149">fa_list_dcons</a>) are both destructive on its input, and constructive on its output.</p>
<h2><a class="anchor" id="id19466"></a>
Type safety</h2>
<p>All data structures can store all reference types, including <a class="el" href="md__data_structures.html#ValueReferences">value&#160;references</a>. The user must rely on guarantees outside the scope of the compiler to assure that the extracted elements are of the right type. There are several ways to do this:</p>
<ul>
<li>Assure that the structure contains a specific type.<ul>
<li>For example, many functions in <em>faudio</em> API return pairs and lists, their documentation clearly stating what type of elements the list will contain.</li>
</ul>
</li>
<li>Assure that the structure contains a generic type.<ul>
<li>For example, a function may require a set of values implementing <a class="el" href="structfa__string__show__t.html">Show</a>.</li>
</ul>
</li>
</ul>
<p>In some cases, it does not matter what type a data structure contains, as the elements are not going to be inspected. For example, <a class="el" href="group___fa_list.html#ga52748615759a2ffef53d2bcaef7bdfb5">fa_list_reverse</a> can receive a list of any type, as it operates purely on the structure of the list and does not need to use its values.</p>
<h1><a class="anchor" id="id182783728273"></a>
Value references</h1>
<p><a class="anchor" id="ValueReferences"></a> Value types can be converted to reference types using a set of conversion functions. These functions take a non reference type and return a so called <em>value reference</em>. This reference can subsequently be destroyed and its value extracted.</p>
<p>A value reference is a proper reference that can be safely stored in a data structure. Like other data structures, value references may be created and destroyed from any thread and have single ownership semantics. Value references are in fact tiny data structures containing a single element. They support all normal data structure operations including <a class="el" href="structfa__equal__t.html">equality</a> or <a class="el" href="structfa__order__t.html">ordering</a>, <a class="el" href="structfa__copy__t.html">copying</a> and <a class="el" href="structfa__destroy__t.html">destruction</a>. In addition, they also support <a class="el" href="structfa__number__t.html">arithmetic</a>.</p>
<p>It is not specified exactly how value references are implemented; however the reference representation of a value typically have a different bit pattern from the represented value. It is not safe to cast a value of a primitive type, such as an integer, to a pointer and treat the resulting address as a value reference. Conversely, it is not safe to treat a value reference as a pointer by dereferencing it, or doing pointer arithmetic. It is guaranteed that the value references will never overlap with real references. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.3-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Dec 2 2013 17:27:33 for faudio v2.7.4 by &#160;<a href="http://www.doxygen.org/index.html">Doxygen<!-- <img class="footer" src="doxygen.png" alt="doxygen"/> --></a> 1.8.3
</small></address>
</body>
</html>
