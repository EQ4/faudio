#!/bin/bash
git submodule init   external_libraries/portmidi;
git submodule update external_libraries/portmidi;

pushd external_libraries/portmidi;

mkdir -p result \
	&& pushd result \
	&& cmake .. \
	    -DCMAKE_BUILD_TYPE=Release \
	    -DCMAKE_ARCHIVE_OUTPUT_DIRECTORY="" \
	    -DCMAKE_LIBRARY_OUTPUT_DIRECTORY="" \
	    -DCMAKE_RUNTIME_OUTPUT_DIRECTORY="" \
	    -DCMAKE_OSX_ARCHITECTURES="i386;x86_64" \
	&& make \
	&& popd \
	&& mkdir -p result/include \
	&& mkdir -p result/lib \
	&& mv result/libportmidi.dylib 	result/lib \
	&& mv result/libportmidi_s.a  	result/lib \
	&& cp pm_common/portmidi.h result/include/portmidi.h;

popd;
